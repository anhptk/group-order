import{I as Ne,J as ke,K as Be,L as Ve,M as qe,N as Ue,O as He,P as je,Q as Le,R as ze,S as We,T as Qe,U as Ze,W as Je,X as $,f as ne,g as oe,h as ae,i as re,j as de,k as se,l as ce,n as ue,o as _e,q as fe,r as Ce,t as be,u as xe,w as he,x as Te,y as ge,z as Se}from"./chunk-Y424W24O.js";import{Ba as $e,Da as Pe,Ia as F,Y,ca as le,ea as me,fa as pe,ga as Ee,ha as De,ja as Oe,la as B,na as ve,oa as Me,pa as we,ra as V,sa as ye,ta as Ge,ua as Ie,va as Ae,xa as Re,ya as Fe}from"./chunk-S4MYAB2F.js";import{$b as I,Bb as x,Cb as M,Db as w,Eb as y,Fb as o,Gb as n,Hb as u,Ib as f,Jb as C,Kb as z,Lb as G,Nc as J,O as U,Ob as T,Oc as K,Qb as c,Qc as X,Rc as R,Yb as W,Zb as l,Zc as ee,_b as D,_c as te,ab as p,ad as N,bb as _,bd as k,cc as g,dc as Q,dd as ie,ec as A,gc as S,hc as E,ic as Z,na as h,pb as H,t as q,ub as d,va as O,vb as j,wa as v,wb as s,yb as L}from"./chunk-4N56W5ZJ.js";var P=class e{constructor(t){this.orders=[],Object.assign(this,t)}static createFromApiModel(t){return new e({id:t.id,createdAt:t.created_at,hostMember:t.host_member,status:t.status,actualAmount:t.actual_amount,orders:t.orders.map(i=>Se.createFromApiModel(i))})}get total(){return this.orders.reduce((t,i)=>t+i.subtotal,0)}get totalCount(){return this.orders.reduce((t,i)=>t+i.totalCount,0)}};var Ke={IN_PROGRESS:"in_progress",COMPLETED:"completed",CANCELLED:"cancelled"};function nt(e,t){if(e&1&&(o(0,"mat-option",4),l(1),n()),e&2){let i=t.$implicit;s("value",i.id),p(),D(i.orderedBy)}}var Ye=(()=>{let t=class t{constructor(a,r,m){this.data=a,this._groupOrderService=r,this._dialogRef=m,this.isSubmitting=!1,this._constructForm()}_constructForm(){this.mainForm=new we({orders:new V(this.data.orders.map(a=>a.id)),actualAmount:new V(this.data.total,[B.required,B.min(0)])})}completeOrder(){let a={orders:this.mainForm.value.orders,actual_amount:this.mainForm.value.actualAmount};this.isSubmitting=!0,this._groupOrderService.complete(this.data.id,a).pipe(U(()=>this.isSubmitting=!1)).subscribe(()=>{this._dialogRef.close(this.data.id)})}};t.\u0275fac=function(r){return new(r||t)(_(je),_($),_(He))},t.\u0275cmp=h({type:t,selectors:[["app-complete-group-order-dialog"]],standalone:!0,features:[g],decls:19,vars:3,consts:[["mat-dialog-title",""],[3,"formGroup"],[1,"w-100"],["formControlName","orders","multiple",""],[3,"value"],["matInput","","formControlName","actualAmount","type","number"],["align","end"],["mat-raised-button","","mat-dialog-close","",1,"mr-2"],[3,"action","disabled","isSubmitting"]],template:function(r,m){r&1&&(o(0,"h2",0),l(1,"Complete order"),n(),o(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),l(6,"Orders"),n(),o(7,"mat-select",3),w(8,nt,2,2,"mat-option",4,M),n()(),o(10,"mat-form-field",2)(11,"mat-label"),l(12,"Actual amount"),n(),u(13,"input",5),n()()(),o(14,"mat-dialog-actions",6)(15,"button",7),l(16,"Close"),n(),o(17,"app-submit-button",8),T("action",function(){return m.completeOrder()}),l(18,"Complete "),n()()),r&2&&(p(3),s("formGroup",m.mainForm),p(5),y(m.data.orders),p(9),s("disabled",!m.mainForm.valid)("isSubmitting",m.isSubmitting))},dependencies:[We,Qe,Ze,le,$e,Fe,Pe,Re,ye,Oe,Ge,ve,Me,Ie,Ae,Je,ze,Ne,Y]});let e=t;return e})();var rt=()=>["expandedDetail"],lt=e=>({$implicit:e});function mt(e,t){e&1&&(o(0,"th",17),l(1," Time "),n())}function pt(e,t){if(e&1&&(o(0,"td",18),l(1),S(2,"date"),n()),e&2){let i=t.$implicit;p(),I(" ",E(2,1,i.createdAt)," ")}}function dt(e,t){e&1&&(o(0,"th",17),l(1," Host "),n())}function st(e,t){if(e&1&&(o(0,"td",18),l(1),n()),e&2){let i=t.$implicit;p(),I(" ",i.hostMember.name," ")}}function ct(e,t){e&1&&(o(0,"th",17),l(1," Actual amount "),n())}function ut(e,t){if(e&1&&(o(0,"td",18),l(1),n()),e&2){let i=t.$implicit;p(),I(" ",i.actualAmount," ")}}function _t(e,t){e&1&&(o(0,"th",17),l(1," Status "),n())}function ft(e,t){if(e&1&&(o(0,"td",18),u(1,"app-status-badge",19),n()),e&2){let i=t.$implicit;p(),s("status",i.status)}}function Ct(e,t){e&1&&(o(0,"th",17),l(1," Actions "),n())}function bt(e,t){if(e&1){let i=G();o(0,"button",21),T("click",function(r){O(i);let m=c().$implicit,b=c();return r.stopPropagation(),v(b.complete(m))}),o(1,"mat-icon"),l(2,"task_alt"),n()()}}function xt(e,t){if(e&1&&(o(0,"td",18),d(1,bt,3,0,"button",20),n()),e&2){let i=t.$implicit,a=c();p(),x(a.currentUserId===i.hostMember.id&&i.status===a.OrderStatusEnum.IN_PROGRESS?1:-1)}}function ht(e,t){e&1&&(o(0,"th",22),l(1,"\xA0"),n())}function Tt(e,t){e&1&&(o(0,"mat-icon"),l(1,"keyboard_arrow_up"),n())}function gt(e,t){e&1&&(o(0,"mat-icon"),l(1,"keyboard_arrow_down"),n())}function St(e,t){if(e&1){let i=G();o(0,"td",18)(1,"button",23),T("click",function(r){let m=O(i).$implicit,b=c();return b.expandedElement=b.expandedElement===m?null:m,v(r.stopPropagation())}),d(2,Tt,2,0,"mat-icon")(3,gt,2,0,"mat-icon"),n()()}if(e&2){let i=t.$implicit,a=c();p(2),x(a.expandedElement===i?2:3)}}function Et(e,t){e&1&&z(0)}function Dt(e,t){if(e&1&&(o(0,"td",18)(1,"div",24),d(2,Et,1,0,"ng-container",25),n()()),e&2){let i=t.$implicit,a=c(),r=W(27);j("colspan",a.columnsToDisplayWithExpand.length),p(),s("@detailExpand",i==a.expandedElement?"expanded":"collapsed"),p(),s("ngTemplateOutlet",r)("ngTemplateOutletContext",A(4,lt,i.orders))}}function Ot(e,t){e&1&&u(0,"tr",26)}function vt(e,t){if(e&1){let i=G();o(0,"tr",27),T("click",function(){let r=O(i).$implicit,m=c();return v(m.expandedElement=m.expandedElement===r?null:r)}),n()}if(e&2){let i=t.$implicit,a=c();L("expanded-row",a.expandedElement===i)}}function Mt(e,t){e&1&&u(0,"tr",28)}function wt(e,t){e&1&&(o(0,"tr",29)(1,"td",30),l(2,"No data."),n()())}function yt(e,t){if(e&1&&(o(0,"tr")(1,"td",32),l(2),n(),o(3,"td",32),l(4),n(),o(5,"td",32),u(6,"app-status-badge",19),n()()),e&2){let i=t.$implicit;p(2),D(i.orderedBy),p(2),D(i.subtotal),p(2),s("status",i.status)}}function Gt(e,t){if(e&1&&(o(0,"table")(1,"tr")(2,"th",31),l(3,"Member"),n(),o(4,"th",31),l(5,"Total"),n(),o(6,"th",31),l(7,"Status"),n()(),w(8,yt,7,3,"tr",null,M),n()),e&2){let i=c().$implicit;p(8),y(i)}}function It(e,t){if(e&1&&(o(0,"div"),d(1,Gt,10,0,"table"),n()),e&2){let i=t.$implicit;p(),x(i.length>0?1:-1)}}var et=(()=>{let t=class t extends Ve{constructor(a,r,m){super(),this._groupOrderService=a,this._appData=r,this._dialog=m,this.OrderStatusEnum=Ke,this.columnsToDisplay=["time","host","amount","status","actions"],this.columnsToDisplayWithExpand=[...this.columnsToDisplay,"expand"],this._appData.currentUser$.subscribe(b=>this.currentUserId=b.id),this._queryRequest=this._constructQueryRequest.bind(this)}_constructQueryRequest(){return this._groupOrderService.query(this.queryParams??{}).pipe(q(a=>a.map(r=>P.createFromApiModel(r))))}complete(a){this._dialog.open(Ye,{data:a}).afterClosed().subscribe(()=>this.refresh())}};t.\u0275fac=function(r){return new(r||t)(_($),_(F),_(Le))},t.\u0275cmp=h({type:t,selectors:[["app-group-orders-table"]],inputs:{queryParams:"queryParams"},standalone:!0,features:[H,g],decls:28,vars:7,consts:[["orderDetails",""],["mat-table","","multiTemplateDataRows","",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","host"],["matColumnDef","amount"],["matColumnDef","status"],["matColumnDef","actions"],["matColumnDef","expand"],["mat-header-cell","","aria-label","row actions",4,"matHeaderCellDef"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","expanding-row",3,"expanded-row","click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","detail-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page",3,"pageSize","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],[3,"status"],["mat-icon-button","","color","warn","aria-label","Complete","matTooltip","Complete"],["mat-icon-button","","color","warn","aria-label","Complete","matTooltip","Complete",3,"click"],["mat-header-cell","","aria-label","row actions"],["mat-icon-button","","aria-label","expand row",3,"click"],[1,"d-flex","overflow-hidden"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-header-row",""],["mat-row","",1,"expanding-row",3,"click"],["mat-row","",1,"detail-row"],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"],[1,"px-4"],[1,"p-4"]],template:function(r,m){r&1&&(o(0,"table",1),f(1,2),d(2,mt,2,0,"th",3)(3,pt,3,3,"td",4),C(),f(4,5),d(5,dt,2,0,"th",3)(6,st,2,1,"td",4),C(),f(7,6),d(8,ct,2,0,"th",3)(9,ut,2,1,"td",4),C(),f(10,7),d(11,_t,2,0,"th",3)(12,ft,2,1,"td",4),C(),f(13,8),d(14,Ct,2,0,"th",3)(15,xt,2,1,"td",4),C(),f(16,9),d(17,ht,2,0,"th",10)(18,St,4,1,"td",4),C(),f(19,11),d(20,Dt,3,6,"td",4),C(),d(21,Ot,1,0,"tr",12)(22,vt,1,2,"tr",13)(23,Mt,1,0,"tr",14)(24,wt,3,0,"tr",15),n(),u(25,"mat-paginator",16),d(26,It,2,1,"ng-template",null,0,Z)),r&2&&(s("dataSource",m.dataSource),p(21),s("matHeaderRowDef",m.columnsToDisplayWithExpand),p(),s("matRowDefColumns",m.columnsToDisplayWithExpand),p(),s("matRowDefColumns",Q(6,rt)),p(2),s("pageSize",m.DEFAULT_PAGINATOR_PAGE_SIZE)("pageSizeOptions",m.PAGINATOR_SIZE_OPTIONS))},dependencies:[ge,de,ce,Ce,ue,se,be,_e,fe,xe,he,Te,pe,me,De,Ee,Ue,X,Be,ke,R,J,qe],data:{animation:[ee("detailExpand",[k("collapsed,void",N({height:"0px",minHeight:"0"})),k("expanded",N({height:"*"})),ie("expanded <=> collapsed",te("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}});let e=t;return e})();var At=e=>({host_member:e});function Rt(e,t){e&1&&u(0,"app-group-orders-table")}function Ft(e,t){e&1&&(o(0,"div",3),l(1,"Login to view content."),n())}function $t(e,t){if(e&1&&(u(0,"app-group-orders-table",6),S(1,"async")),e&2){let i,a=c(2);s("queryParams",A(3,At,(i=E(1,1,a.currentUser$))==null?null:i.id))}}function Pt(e,t){e&1&&(o(0,"div",3),l(1,"Login to view content."),n())}function Nt(e,t){if(e&1&&(d(0,$t,2,5,"app-group-orders-table",6),S(1,"async"),d(2,Pt,2,0,"div",3)),e&2){let i=c();x(E(1,1,i.currentUser$)?0:2)}}var hi=(()=>{let t=class t{constructor(a){this._appData=a,this.currentUser$=this._appData.currentUser$}};t.\u0275fac=function(r){return new(r||t)(_(F))},t.\u0275cmp=h({type:t,selectors:[["app-group-orders-dashboard"]],standalone:!0,features:[g],decls:9,vars:3,consts:[[1,"text-align-center"],["mat-stretch-tabs","false","mat-align-tabs","start"],["label","All"],[1,"m-4"],["label","Mine"],["matTabContent",""],[3,"queryParams"]],template:function(r,m){r&1&&(o(0,"h1",0),l(1,"Group orders"),n(),o(2,"mat-tab-group",1)(3,"mat-tab",2),d(4,Rt,1,0,"app-group-orders-table"),S(5,"async"),d(6,Ft,2,0,"div",3),n(),o(7,"mat-tab",4),d(8,Nt,3,3,"ng-template",5),n()()),r&2&&(p(4),x(E(5,1,m.currentUser$)?4:6))},dependencies:[re,ne,oe,ae,R,K,et]});let e=t;return e})();export{hi as GroupOrdersDashboardComponent};
